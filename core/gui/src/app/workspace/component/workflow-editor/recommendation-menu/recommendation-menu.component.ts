import { Component, Input } from '@angular/core';
import {WorkflowVersionService} from "../../../../dashboard/service/user/workflow-version/workflow-version.service";
import {untilDestroyed} from "@ngneat/until-destroy";
import {WorkflowActionService} from "../../../service/workflow-graph/model/workflow-action.service";
import {WorkflowMetadata} from "../../../../dashboard/type/workflow-metadata.interface";
import {WorkflowContent} from "../../../../common/type/workflow";

@Component({
  selector: 'texera-operator-recommendation-menu',
  templateUrl: './recommendation-menu.component.html',
  styleUrls: ['./recommendation-menu.component.scss'],
})
export class RecommendationMenuComponent {
  @Input() tips: string[] = [];
  selectedRecommendationIndex: number | null = null;

  constructor(
    public workflowVersionService: WorkflowVersionService,
    public workflowActionService: WorkflowActionService,
  ) {
  }

  onRecommendedOperationClick(index: number): void {
    this.selectedRecommendationIndex = index;

    const recommendedWorkflow = this.getMockedWorkflowPreview();
    this.workflowVersionService.displayRecommendedWorkflowPreview(recommendedWorkflow);
  }

  onConfirmClick(): void {
    if (this.selectedRecommendationIndex !== null) {
      const selectedTip = this.tips[this.selectedRecommendationIndex];
      console.log(`Confirmed tip: ${selectedTip}`);
      // Handle the confirmed tip action
    }
  }

  private getMockedWorkflowPreview(): WorkflowContent {
    const workflowCsvScanTweets = "{\"operators\":[{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"operatorType\":\"CSVFileScan\",\"operatorVersion\":\"fe684b5e5120c6a24077422336e82c44a24f3c14\",\"operatorProperties\":{\"fileEncoding\":\"UTF_8\",\"customDelimiter\":\",\",\"hasHeader\":true,\"fileName\":\"/jiadongb@uci.edu/DS4ALL Lecture Example/v16/clean_tweets.csv\"},\"inputPorts\":[],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"CSV File Scan\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false}],\"operatorPositions\":{\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\":{\"x\":495,\"y\":220}},\"links\":[],\"commentBoxes\":[],\"settings\":{\"dataTransferBatchSize\":400}}"
    const workflowBranch1ProjectionForTweetsDate = "{\"operators\":[{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"operatorType\":\"CSVFileScan\",\"operatorVersion\":\"fe684b5e5120c6a24077422336e82c44a24f3c14\",\"operatorProperties\":{\"fileEncoding\":\"UTF_8\",\"customDelimiter\":\",\",\"hasHeader\":true,\"fileName\":\"/jiadongb@uci.edu/DS4ALL Lecture Example/v16/clean_tweets.csv\"},\"inputPorts\":[],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"CSV File Scan\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"operatorType\":\"Projection\",\"operatorVersion\":\"25faefd4bf57f6fc1b0b99384eded40f593332c0\",\"operatorProperties\":{\"isDrop\":false,\"attributes\":[{\"alias\":\"\",\"originalAttribute\":\"tweet_id\"},{\"alias\":\"\",\"originalAttribute\":\"create_at_month\"}]},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Projection\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false}],\"operatorPositions\":{\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\":{\"x\":495,\"y\":220},\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\":{\"x\":621,\"y\":276}},\"links\":[{\"linkID\":\"link-bcc779db-2e37-44db-8b1e-f44f1fdff15c\",\"source\":{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"portID\":\"input-0\"}}],\"commentBoxes\":[],\"settings\":{\"dataTransferBatchSize\":400}"
    const workflowBranch1AggregationForTweets = "{\"operators\":[{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"operatorType\":\"CSVFileScan\",\"operatorVersion\":\"fe684b5e5120c6a24077422336e82c44a24f3c14\",\"operatorProperties\":{\"fileEncoding\":\"UTF_8\",\"customDelimiter\":\",\",\"hasHeader\":true,\"fileName\":\"/jiadongb@uci.edu/DS4ALL Lecture Example/v16/clean_tweets.csv\"},\"inputPorts\":[],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"CSV File Scan\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"operatorType\":\"Projection\",\"operatorVersion\":\"25faefd4bf57f6fc1b0b99384eded40f593332c0\",\"operatorProperties\":{\"isDrop\":false,\"attributes\":[{\"alias\":\"\",\"originalAttribute\":\"tweet_id\"},{\"alias\":\"\",\"originalAttribute\":\"create_at_month\"}]},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Projection\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\",\"operatorType\":\"Aggregate\",\"operatorVersion\":\"5fa7a84adc67108373c1cda41532d5011112c962\",\"operatorProperties\":{\"aggregations\":[{\"aggFunction\":\"count\",\"attribute\":\"tweet_id\",\"result attribute\":\"#tweets\"}],\"groupByKeys\":[\"create_at_month\"]},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Aggregate\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false}],\"operatorPositions\":{\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\":{\"x\":495,\"y\":220},\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\":{\"x\":621,\"y\":276},\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\":{\"x\":761,\"y\":276}},\"links\":[{\"linkID\":\"link-bcc779db-2e37-44db-8b1e-f44f1fdff15c\",\"source\":{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"portID\":\"input-0\"}},{\"linkID\":\"link-4357d687-6288-4dc6-80a5-a48e7dc9165d\",\"source\":{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\",\"portID\":\"input-0\"}}],\"commentBoxes\":[],\"settings\":{\"dataTransferBatchSize\":400}}"
    const workflowBranch1BarChart = "{\"operators\":[{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"operatorType\":\"CSVFileScan\",\"operatorVersion\":\"fe684b5e5120c6a24077422336e82c44a24f3c14\",\"operatorProperties\":{\"fileEncoding\":\"UTF_8\",\"customDelimiter\":\",\",\"hasHeader\":true,\"fileName\":\"/jiadongb@uci.edu/DS4ALL Lecture Example/v16/clean_tweets.csv\"},\"inputPorts\":[],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"CSV File" +
      " Scan\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"operatorType\":\"Projection\",\"operatorVersion\":\"25faefd4bf57f6fc1b0b99384eded40f593332c0\",\"operatorProperties\":{\"isDrop\":false,\"attributes\":[{\"alias\":\"\",\"originalAttribute\":\"tweet_id\"},{\"alias\":\"\",\"originalAttribute\":\"create_at_month\"}]},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Projection\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\",\"operatorType\":\"Aggregate\",\"operatorVersion\":\"5fa7a84adc67108373c1cda41532d5011112c962\",\"operatorProperties\":{\"aggregations\":[{\"aggFunction\":\"count\",\"attribute\":\"tweet_id\",\"result attribute\":\"#tweets\"}],\"groupByKeys\":[\"create_at_month\"]},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Aggregate\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"BarChart-operator-e364e77b-43ae-4734-bca4-efb3aa447bd5\",\"operatorType\":\"BarChart\",\"operatorVersion\":\"25faefd4bf57f6fc1b0b99384eded40f593332c0\",\"operatorProperties\":{\"categoryColumn\":\"#tweets\",\"horizontalOrientation\":false,\"fields\":\"create_at_month\",\"value\":\"#tweets\"},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Bar Chart\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false}],\"operatorPositions\":{\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\":{\"x\":495,\"y\":220},\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\":{\"x\":621,\"y\":276},\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\":{\"x\":761,\"y\":276},\"BarChart-operator-e364e77b-43ae-4734-bca4-efb3aa447bd5\":{\"x\":917,\"y\":216}},\"links\":[{\"linkID\":\"link-bcc779db-2e37-44db-8b1e-f44f1fdff15c\",\"source\":{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"portID\":\"input-0\"}},{\"linkID\":\"link-4357d687-6288-4dc6-80a5-a48e7dc9165d\",\"source\":{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\",\"portID\":\"input-0\"}},{\"linkID\":\"link-1c86596e-86ba-4059-ba0f-f996f8daa598\",\"source\":{\"operatorID\":\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"BarChart-operator-e364e77b-43ae-4734-bca4-efb3aa447bd5\",\"portID\":\"input-0\"}}],\"commentBoxes\":[],\"settings\":{\"dataTransferBatchSize\":400}}";
    const workflowBranch1LineChart = "{\"operators\":[{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"operatorType\":\"CSVFileScan\",\"operatorVersion\":\"fe684b5e5120c6a24077422336e82c44a24f3c14\",\"operatorProperties\":{\"fileEncoding\":\"UTF_8\",\"customDelimiter\":\",\",\"hasHeader\":true,\"fileName\":\"/jiadongb@uci.edu/DS4ALL Lecture Example/v16/clean_tweets.csv\"},\"inputPorts\":[],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"CSV File" +
      " Scan\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"operatorType\":\"Projection\",\"operatorVersion\":\"25faefd4bf57f6fc1b0b99384eded40f593332c0\",\"operatorProperties\":{\"isDrop\":false,\"attributes\":[{\"alias\":\"\",\"originalAttribute\":\"tweet_id\"},{\"alias\":\"\",\"originalAttribute\":\"create_at_month\"}]},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Projection\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\",\"operatorType\":\"Aggregate\",\"operatorVersion\":\"5fa7a84adc67108373c1cda41532d5011112c962\",\"operatorProperties\":{\"aggregations\":[{\"aggFunction\":\"count\",\"attribute\":\"tweet_id\",\"result attribute\":\"#tweets\"}],\"groupByKeys\":[\"create_at_month\"]},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Aggregate\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false},{\"operatorID\":\"LineChart-operator-2bbfc406-5603-4f9c-a9e1-c855fd8dc42f\",\"operatorType\":\"LineChart\",\"operatorVersion\":\"25faefd4bf57f6fc1b0b99384eded40f593332c0\",\"operatorProperties\":{\"yLabel\":\"Y Axis\",\"xLabel\":\"X Axis\",\"lines\":[{\"mode\":\"line with dots\",\"name\":\"\",\"color\":\"\",\"y\":\"#tweets\",\"x\":\"create_at_month\"}]},\"inputPorts\":[{\"portID\":\"input-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false,\"dependencies\":[]}],\"outputPorts\":[{\"portID\":\"output-0\",\"displayName\":\"\",\"allowMultiInputs\":false,\"isDynamicPort\":false}],\"showAdvanced\":false,\"isDisabled\":false,\"customDisplayName\":\"Line Chart\",\"dynamicInputPorts\":false,\"dynamicOutputPorts\":false}],\"operatorPositions\":{\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\":{\"x\":495,\"y\":220},\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\":{\"x\":621,\"y\":276},\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\":{\"x\":761,\"y\":276},\"LineChart-operator-2bbfc406-5603-4f9c-a9e1-c855fd8dc42f\":{\"x\":879,\"y\":392}},\"links\":[{\"linkID\":\"link-bcc779db-2e37-44db-8b1e-f44f1fdff15c\",\"source\":{\"operatorID\":\"CSVFileScan-operator-3a2d983b-731d-41c1-a0d5-de3ccc8363c1\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"portID\":\"input-0\"}},{\"linkID\":\"link-4357d687-6288-4dc6-80a5-a48e7dc9165d\",\"source\":{\"operatorID\":\"Projection-operator-7faaea3d-dc04-4a61-871b-05a9518556dc\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\",\"portID\":\"input-0\"}},{\"linkID\":\"link-cbbbb468-5993-4ceb-be64-e51baa18ed80\",\"source\":{\"operatorID\":\"Aggregate-operator-11255734-113b-40bb-b8bc-cede5daa08d6\",\"portID\":\"output-0\"},\"target\":{\"operatorID\":\"LineChart-operator-2bbfc406-5603-4f9c-a9e1-c855fd8dc42f\",\"portID\":\"input-0\"}}],\"commentBoxes\":[],\"settings\":{\"dataTransferBatchSize\":400}}";
    let currentWorkflow = this.workflowActionService.getWorkflow();

    return currentWorkflow.content;
  }
}
